# automations.yaml
- id: 'shotstopper_initial_state_sync'
  alias: "ShotStopper: Initial State Sync"
  description: "When the ShotStopper connects, publish all relevant states."
  trigger:
    - platform: mqtt
      topic: "shotstopper/status"
      payload: "online"
  action:
    # --- Power State ---
    - service: mqtt.publish
      data:
        topic: "homeassistant/switch/linea_micra_power/state"
        payload_template: "{{ states('switch.linea_micra_power') }}"
        retain: true

    # --- Pre-infusion Mode ---
    - service: mqtt.publish
      data:
        topic: "homeassistant/select/linea_micra_mode/state"
        payload_template: "{{ states('select.linea_micra_mode') }}"
        retain: true

    # --- Target Temperature ---
    - service: mqtt.publish
      data:
        topic: "homeassistant/number/linea_micra_target_temp/state"
        payload_template: "{{ states('number.linea_micra_target_temp') }}"
        retain: true

    # --- Steam Power ---
    - service: mqtt.publish
      data:
        topic: "homeassistant/number/linea_micra_steam_power/state"
        payload_template: "{{ states('number.linea_micra_steam_power') }}"
        retain: true

    # --- Pre-infusion Time ---
    - service: mqtt.publish
      data:
        topic: "homeassistant/number/linea_micra_preinfusion_time/state"
        payload_template: "{{ states('number.linea_micra_preinfusion_time') }}"
        retain: true

    # --- Last Shot Duration ---
    - service: mqtt.publish
      data:
        topic: "homeassistant/number/linea_micra_last_shot/state"
        payload_template: "{{ states('number.linea_micra_last_shot') }}"
        retain: true
  mode: single
